<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ona Hotels - C√°lculo Ahorro Bombas (TER280)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    /* Paleta de colores corporativa Ona Hotels */
    :root {
      --ona-teal-dark: #006B7D;
      --ona-teal: #008B9C;
      --ona-teal-light: #00A8BD;
      --ona-teal-lighter: #E0F4F7;
      --ona-white: #FFFFFF;
      --ona-grey-light: #F8F9FA;
      --ona-grey: #E9ECEF;
      --ona-grey-dark: #6C757D;
      --ona-text: #212529;
      --ona-border: #DEE2E6;
      --ona-success: #28A745;
      --ona-warning: #FFC107;
    }

    * { box-sizing: border-box; }
    
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; 
      padding: 0;
      background: linear-gradient(135deg, var(--ona-grey-light) 0%, var(--ona-grey) 100%);
      color: var(--ona-text);
    }

    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header con logo */
    header { 
      background: var(--ona-white);
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0, 107, 125, 0.08);
      margin-bottom: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 25px;
      flex-wrap: wrap;
    }

    header .header-content {
      flex: 1;
    }

    header h1 { 
      margin: 0 0 6px 0; 
      font-size: 24px; 
      font-weight: 600;
      color: var(--ona-teal-dark);
      line-height: 1.3;
    }

    header .subtitle {
      font-size: 13px;
      color: var(--ona-grey-dark);
      margin: 0;
      line-height: 1.4;
    }

    header img { 
      height: 55px; 
      border-radius: 6px;
      flex-shrink: 0;
    }

    .btn-back {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--ona-grey);
      color: var(--ona-text);
      text-decoration: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
      margin-bottom: 15px;
    }

    .btn-back:hover {
      background: var(--ona-border);
      transform: translateX(-3px);
    }

    /* Tarjetas */
    .card { 
      background: var(--ona-white);
      padding: 24px 28px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0, 107, 125, 0.08);
      border: 1px solid var(--ona-border);
      margin-bottom: 25px;
    }

    .card h2 { 
      margin: 0 0 18px 0; 
      font-size: 18px;
      font-weight: 600;
      color: var(--ona-teal-dark);
      border-bottom: 2px solid var(--ona-teal-light);
      padding-bottom: 8px;
    }

    .card h3 {
      margin: 20px 0 12px 0;
      font-size: 15px;
      font-weight: 600;
      color: var(--ona-teal);
    }

    /* Formulario */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-size: 13px;
      font-weight: 600;
      color: var(--ona-text);
      margin-bottom: 6px;
    }

    label .unit {
      font-weight: 400;
      color: var(--ona-grey-dark);
      font-size: 12px;
    }

    input, select {
      padding: 10px 12px;
      border: 1px solid var(--ona-border);
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--ona-teal);
      box-shadow: 0 0 0 3px var(--ona-teal-lighter);
    }

    /* Botones */
    .btn {
      padding: 11px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--ona-teal);
      color: white;
    }

    .btn-primary:hover {
      background: var(--ona-teal-dark);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 139, 156, 0.3);
    }

    .btn-export {
      background: var(--ona-success);
      color: white;
    }

    .btn-export:hover {
      background: #218838;
    }

    .btn-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    /* Resumen de resultados */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }

    .summary-item {
      background: linear-gradient(135deg, var(--ona-teal-light) 0%, var(--ona-teal) 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 139, 156, 0.2);
    }

    .summary-item.warning {
      background: linear-gradient(135deg, #FFD54F 0%, var(--ona-warning) 100%);
      color: var(--ona-text);
    }

    .summary-item.success {
      background: linear-gradient(135deg, #66BB6A 0%, var(--ona-success) 100%);
    }

    .summary-label {
      font-size: 12px;
      font-weight: 500;
      opacity: 0.95;
      margin-bottom: 6px;
    }

    .summary-value {
      font-size: 28px;
      font-weight: 700;
      line-height: 1.2;
    }

    .summary-unit {
      font-size: 14px;
      font-weight: 400;
      opacity: 0.9;
    }

    /* Gr√°ficos */
    .chart-container {
      position: relative;
      height: 350px;
      margin: 20px 0;
    }

    /* Metodolog√≠a */
    .methodology {
      background: var(--ona-grey-light);
      padding: 16px 20px;
      border-radius: 8px;
      border-left: 4px solid var(--ona-teal);
      margin: 20px 0;
      font-size: 13px;
      line-height: 1.6;
    }

    .methodology strong {
      color: var(--ona-teal-dark);
    }

    .formula {
      background: white;
      padding: 12px 16px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      margin: 10px 0;
      text-align: center;
      font-size: 14px;
      border: 1px solid var(--ona-border);
    }

    /* Referencias normativas */
    .reference {
      background: var(--ona-teal-lighter);
      padding: 12px 16px;
      border-radius: 6px;
      font-size: 12px;
      margin: 15px 0;
      border-left: 3px solid var(--ona-teal);
    }

    .reference strong {
      color: var(--ona-teal-dark);
    }

    .info-box {
      background: #FFF3CD;
      border-left: 4px solid var(--ona-warning);
      padding: 12px 16px;
      border-radius: 6px;
      font-size: 12px;
      margin: 15px 0;
    }

    /* Tabla de par√°metros */
    table { 
      width: 100%; 
      border-collapse: collapse; 
      font-size: 13px;
      margin: 15px 0;
    }

    thead {
      background: var(--ona-teal-dark);
      color: var(--ona-white);
    }

    th { 
      padding: 12px 10px; 
      text-align: left; 
      font-weight: 600;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    td { 
      padding: 10px; 
      border: 1px solid var(--ona-border);
    }

    tbody tr:nth-child(even) {
      background: var(--ona-grey-light);
    }

    tbody tr:hover {
      background: var(--ona-teal-lighter);
    }

    /* Responsive */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        text-align: center;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .summary-grid {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 11px;
      }

      th, td {
        padding: 8px 6px;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <a href="index.html" class="btn-back">‚Üê Volver al men√∫ principal</a>

    <header>
      <div class="header-content">
        <h1>C√°lculo de Ahorro Energ√©tico - Bombas</h1>
        <p class="subtitle">Ficha TER280: Sustituci√≥n de bomba por otra m√°s eficiente | Sector Terciario</p>
      </div>
      <img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/b806f497-fbe0-4b2d-9354-245962d5b1a4" alt="Ona Hotels" />
    </header>

    <!-- Informaci√≥n de la ficha -->
    <div class="card">
      <h2>üìã √Åmbito de Aplicaci√≥n</h2>
      
      <div class="reference">
        <strong>Normativa aplicable:</strong> Ficha TER280 - Sustituci√≥n de bomba por otra m√°s eficiente
      </div>

      <p style="font-size: 14px; line-height: 1.6; margin: 15px 0;">
        Esta ficha aplica a la sustituci√≥n de una bomba por otra m√°s eficiente, <strong>ambas sin regulaci√≥n</strong>. Las bombas deber√°n dar servicio a una instalaci√≥n que <strong>no ha experimentado cambios sustanciales</strong> en su velocidad, presi√≥n y caudal de trabajo.
      </p>

      <div class="info-box">
        <strong>‚ö†Ô∏è Requisitos:</strong> La l√≠nea en la que se encuentra la bomba deber√° tener implantados equipos de medida de horas de funcionamiento, con registros de al menos un a√±o anterior a la actuaci√≥n.
      </div>

      <div class="info-box">
        <strong>‚ÑπÔ∏è No aplica a:</strong> Bombas que est√©n de reserva en el circuito hidr√°ulico para situaciones de emergencia.
      </div>
    </div>

    <!-- Par√°metros del c√°lculo -->
    <div class="card">
      <h2>üîß Par√°metros de las Bombas</h2>

      <h3>Bomba Existente (a sustituir)</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="powerOld">Potencia bomba existente <span class="unit">(kW)</span></label>
          <input type="number" id="powerOld" value="7.5" min="0" step="0.1" />
        </div>

        <div class="form-group">
          <label for="effHydOld">Rendimiento hidr√°ulico (Œ∑H) <span class="unit">(%)</span></label>
          <input type="number" id="effHydOld" value="70" min="0" max="100" step="0.1" />
        </div>

        <div class="form-group">
          <label for="effMechOld">Rendimiento mec√°nico (Œ∑M) <span class="unit">(%)</span></label>
          <input type="number" id="effMechOld" value="85" min="0" max="100" step="0.1" />
        </div>

        <div class="form-group">
          <label for="effTotalOld" style="color: var(--ona-teal-dark);">Rendimiento total (Œ∑T = Œ∑H √ó Œ∑M) <span class="unit">(%)</span></label>
          <input type="number" id="effTotalOld" value="59.5" readonly style="background: var(--ona-grey-light); font-weight: 600;" />
        </div>
      </div>

      <h3>Bomba Nueva (m√°s eficiente)</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="effHydNew">Rendimiento hidr√°ulico (Œ∑H) <span class="unit">(%)</span></label>
          <input type="number" id="effHydNew" value="80" min="0" max="100" step="0.1" />
        </div>

        <div class="form-group">
          <label for="effMechNew">Rendimiento mec√°nico (Œ∑M) <span class="unit">(%)</span></label>
          <input type="number" id="effMechNew" value="92" min="0" max="100" step="0.1" />
        </div>

        <div class="form-group">
          <label for="effTotalNew" style="color: var(--ona-teal-dark);">Rendimiento total (Œ∑T = Œ∑H √ó Œ∑M) <span class="unit">(%)</span></label>
          <input type="number" id="effTotalNew" value="73.6" readonly style="background: var(--ona-grey-light); font-weight: 600;" />
        </div>
      </div>

      <h3>Par√°metros de Operaci√≥n</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="operatingHours">Horas anuales de funcionamiento <span class="unit">(h/a√±o)</span></label>
          <input type="number" id="operatingHours" value="4380" min="0" step="100" />
        </div>

        <div class="form-group">
          <label for="numPumps">N√∫mero de bombas a sustituir</label>
          <input type="number" id="numPumps" value="1" min="1" max="20" step="1" />
        </div>
      </div>

      <div class="info-box">
        <strong>‚ÑπÔ∏è Rendimiento Total (Œ∑T):</strong> Se calcula como el producto del rendimiento hidr√°ulico (Œ∑H) por el rendimiento mec√°nico (Œ∑M). Los valores deben estar normalizados conforme a su correspondiente norma ISO (Anexo II).
      </div>
    </div>

    <!-- Par√°metros econ√≥micos -->
    <div class="card">
      <h2>üí∞ Par√°metros Econ√≥micos</h2>

      <div class="form-grid">
        <div class="form-group">
          <label for="electricityPrice">Precio electricidad <span class="unit">(‚Ç¨/kWh)</span></label>
          <input type="number" id="electricityPrice" value="0.15" min="0" step="0.01" />
        </div>

        <div class="form-group">
          <label for="co2Factor">Factor emisi√≥n CO‚ÇÇ electricidad <span class="unit">(kg CO‚ÇÇ/kWh)</span></label>
          <input type="number" id="co2Factor" value="0.30" min="0" step="0.01" />
        </div>
      </div>

      <div class="btn-actions">
        <button class="btn btn-primary" onclick="calculateSavings()">üîÑ Calcular ahorros</button>
      </div>
    </div>

    <!-- Metodolog√≠a -->
    <div class="card">
      <h2>üìê Metodolog√≠a de C√°lculo (seg√∫n TER280)</h2>
      
      <div class="methodology">
        <p><strong>F√≥rmula principal:</strong></p>
        <div class="formula">
          AETOTAL = (1/Œ∑a - 1/Œ∑p) √ó P √ó hm
        </div>
        
        <p><strong>C√°lculo del rendimiento total:</strong></p>
        <div class="formula">
          Œ∑T = Œ∑H √ó Œ∑M
        </div>
        
        <p>Donde:</p>
        <ul style="margin: 10px 0; padding-left: 25px;">
          <li><strong>Œ∑a:</strong> Rendimiento total de la bomba sustituida (%)</li>
          <li><strong>Œ∑p:</strong> Rendimiento total de la bomba nueva (%)</li>
          <li><strong>Œ∑H:</strong> Rendimiento hidr√°ulico (%)</li>
          <li><strong>Œ∑M:</strong> Rendimiento mec√°nico (%)</li>
          <li><strong>P:</strong> Potencia de la bomba sustituida (kW)</li>
          <li><strong>hm:</strong> Horas anuales de funcionamiento promedio (h/a√±o)</li>
          <li><strong>AETOTAL:</strong> Ahorro anual de energ√≠a final total (kWh/a√±o)</li>
        </ul>
      </div>
    </div>

    <!-- Resumen de resultados -->
    <div class="card">
      <h2>üìä Resumen de Resultados</h2>
      
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">Ahorro por Bomba</div>
          <div class="summary-value"><span id="savingsPerPump">0</span> <span class="summary-unit">kWh/a√±o</span></div>
        </div>
        <div class="summary-item success">
          <div class="summary-label">Ahorro Total (AETOTAL)</div>
          <div class="summary-value"><span id="savingsTotal">0</span> <span class="summary-unit">kWh/a√±o</span></div>
        </div>
        <div class="summary-item warning">
          <div class="summary-label">Ahorro Econ√≥mico Anual</div>
          <div class="summary-value"><span id="costSavings">0</span> <span class="summary-unit">‚Ç¨/a√±o</span></div>
        </div>
        <div class="summary-item success">
          <div class="summary-label">Reducci√≥n Emisiones CO‚ÇÇ</div>
          <div class="summary-value"><span id="co2Reduction">0</span> <span class="summary-unit">kg/a√±o</span></div>
        </div>
      </div>

      <div class="summary-grid" style="margin-top: 20px;">
        <div class="summary-item warning">
          <div class="summary-label">Ahorro 5 a√±os</div>
          <div class="summary-value"><span id="savings5years">0</span> <span class="summary-unit">‚Ç¨</span></div>
        </div>
        <div class="summary-item warning">
          <div class="summary-label">Ahorro 10 a√±os</div>
          <div class="summary-value"><span id="savings10years">0</span> <span class="summary-unit">‚Ç¨</span></div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Mejora de Rendimiento</div>
          <div class="summary-value"><span id="efficiencyImprovement">0</span> <span class="summary-unit">%</span></div>
        </div>
      </div>
    </div>

    <!-- Gr√°ficos -->
    <div class="card">
      <h2>üìà An√°lisis Gr√°fico</h2>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px;">
        <div>
          <h3>Comparativa de Rendimientos</h3>
          <div class="chart-container">
            <canvas id="efficiencyChart"></canvas>
          </div>
        </div>
        <div>
          <h3>Distribuci√≥n del Ahorro</h3>
          <div class="chart-container">
            <canvas id="savingsDistChart"></canvas>
          </div>
        </div>
      </div>

      <div style="margin-top: 30px;">
        <h3>Proyecci√≥n de Ahorros Acumulados</h3>
        <div class="chart-container">
          <canvas id="projectionChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Tabla de an√°lisis detallado -->
    <div class="card">
      <h2>üìã An√°lisis Detallado</h2>
      
      <table>
        <thead>
          <tr>
            <th>Par√°metro</th>
            <th>Bomba Existente</th>
            <th>Bomba Nueva</th>
            <th>Mejora</th>
          </tr>
        </thead>
        <tbody id="detailTable">
          <!-- Se llenar√° din√°micamente -->
        </tbody>
      </table>
    </div>

    <!-- Botones de exportaci√≥n -->
    <div class="card">
      <h2>üíæ Exportar Informe</h2>
      <div class="btn-actions">
        <button class="btn btn-export" onclick="exportToPDF()">üìÑ Descargar PDF</button>
        <button class="btn btn-export" onclick="exportToCSV()">üìä Exportar CSV</button>
      </div>
    </div>
  </div>

  <script>
    let efficiencyChart, savingsDistChart, projectionChart;

    // Calcular rendimientos totales autom√°ticamente
    function updateEfficiencyOld() {
      const hydOld = parseFloat(document.getElementById('effHydOld').value) || 0;
      const mechOld = parseFloat(document.getElementById('effMechOld').value) || 0;
      const totalOld = (hydOld * mechOld) / 100;
      document.getElementById('effTotalOld').value = totalOld.toFixed(2);
      calculateSavings();
    }

    function updateEfficiencyNew() {
      const hydNew = parseFloat(document.getElementById('effHydNew').value) || 0;
      const mechNew = parseFloat(document.getElementById('effMechNew').value) || 0;
      const totalNew = (hydNew * mechNew) / 100;
      document.getElementById('effTotalNew').value = totalNew.toFixed(2);
      calculateSavings();
    }

    // Recalcular al cambiar inputs
    document.getElementById('effHydOld').addEventListener('input', updateEfficiencyOld);
    document.getElementById('effMechOld').addEventListener('input', updateEfficiencyOld);
    document.getElementById('effHydNew').addEventListener('input', updateEfficiencyNew);
    document.getElementById('effMechNew').addEventListener('input', updateEfficiencyNew);

    const inputs = ['powerOld', 'operatingHours', 'numPumps', 'electricityPrice', 'co2Factor'];
    inputs.forEach(id => {
      document.getElementById(id).addEventListener('input', calculateSavings);
    });

    function calculateSavings() {
      const powerOld = parseFloat(document.getElementById('powerOld').value) || 0;
      const effTotalOld = parseFloat(document.getElementById('effTotalOld').value) || 0;
      const effTotalNew = parseFloat(document.getElementById('effTotalNew').value) || 0;
      const operatingHours = parseFloat(document.getElementById('operatingHours').value) || 0;
      const numPumps = parseFloat(document.getElementById('numPumps').value) || 1;
      const electricityPrice = parseFloat(document.getElementById('electricityPrice').value) || 0.15;
      const co2Factor = parseFloat(document.getElementById('co2Factor').value) || 0.30;

      // Convertir rendimientos a fracci√≥n decimal
      const etaOld = effTotalOld / 100;
      const etaNew = effTotalNew / 100;

      // C√ÅLCULO SEG√öN TER280: AETOTAL = (1/Œ∑a - 1/Œ∑p) √ó P √ó hm
      let savingsPerPump = 0;
      if (etaOld > 0 && etaNew > 0) {
        savingsPerPump = (1/etaOld - 1/etaNew) * powerOld * operatingHours;
      }

      const savingsTotal = savingsPerPump * numPumps;
      const costSavings = savingsTotal * electricityPrice;
      const co2Reduction = savingsTotal * co2Factor;
      const savings5years = costSavings * 5;
      const savings10years = costSavings * 10;
      
      // Mejora de rendimiento en puntos porcentuales
      const efficiencyImprovement = effTotalNew - effTotalOld;

      // Actualizar resumen
      document.getElementById('savingsPerPump').textContent = Math.round(savingsPerPump).toLocaleString();
      document.getElementById('savingsTotal').textContent = Math.round(savingsTotal).toLocaleString();
      document.getElementById('costSavings').textContent = Math.round(costSavings).toLocaleString();
      document.getElementById('co2Reduction').textContent = Math.round(co2Reduction).toLocaleString();
      document.getElementById('savings5years').textContent = Math.round(savings5years).toLocaleString();
      document.getElementById('savings10years').textContent = Math.round(savings10years).toLocaleString();
      document.getElementById('efficiencyImprovement').textContent = efficiencyImprovement.toFixed(1);

      // Actualizar tabla detallada
      updateDetailTable(effTotalOld, effTotalNew, efficiencyImprovement);

      // Actualizar gr√°ficos
      updateCharts(effTotalOld, effTotalNew, savingsPerPump, savingsTotal, costSavings);
    }

    function updateDetailTable(effOld, effNew, improvement) {
      const hydOld = parseFloat(document.getElementById('effHydOld').value) || 0;
      const mechOld = parseFloat(document.getElementById('effMechOld').value) || 0;
      const hydNew = parseFloat(document.getElementById('effHydNew').value) || 0;
      const mechNew = parseFloat(document.getElementById('effMechNew').value) || 0;
      const powerOld = parseFloat(document.getElementById('powerOld').value) || 0;

      const tbody = document.getElementById('detailTable');
      tbody.innerHTML = `
        <tr>
          <td><strong>Potencia</strong></td>
          <td>${powerOld.toFixed(2)} kW</td>
          <td>${powerOld.toFixed(2)} kW</td>
          <td>-</td>
        </tr>
        <tr>
          <td><strong>Rendimiento Hidr√°ulico (Œ∑H)</strong></td>
          <td>${hydOld.toFixed(1)}%</td>
          <td>${hydNew.toFixed(1)}%</td>
          <td style="color: var(--ona-success); font-weight: 600;">+${(hydNew - hydOld).toFixed(1)}%</td>
        </tr>
        <tr>
          <td><strong>Rendimiento Mec√°nico (Œ∑M)</strong></td>
          <td>${mechOld.toFixed(1)}%</td>
          <td>${mechNew.toFixed(1)}%</td>
          <td style="color: var(--ona-success); font-weight: 600;">+${(mechNew - mechOld).toFixed(1)}%</td>
        </tr>
        <tr style="background: var(--ona-teal-lighter);">
          <td><strong>Rendimiento Total (Œ∑T)</strong></td>
          <td><strong>${effOld.toFixed(2)}%</strong></td>
          <td><strong>${effNew.toFixed(2)}%</strong></td>
          <td style="color: var(--ona-success); font-weight: 700;">+${improvement.toFixed(2)}%</td>
        </tr>
      `;
    }

    function updateCharts(effOld, effNew, savingsPerPump, savingsTotal, annualSavings) {
      const onaColors = {
        tealDark: '#006B7D',
        teal: '#008B9C',
        tealLight: '#00A8BD',
        success: '#28A745',
        warning: '#FFC107'
      };

      const hydOld = parseFloat(document.getElementById('effHydOld').value) || 0;
      const mechOld = parseFloat(document.getElementById('effMechOld').value) || 0;
      const hydNew = parseFloat(document.getElementById('effHydNew').value) || 0;
      const mechNew = parseFloat(document.getElementById('effMechNew').value) || 0;
      const numPumps = parseFloat(document.getElementById('numPumps').value) || 1;

      // Gr√°fico de comparativa de rendimientos
      const ctxEff = document.getElementById('efficiencyChart').getContext('2d');
      if (efficiencyChart) efficiencyChart.destroy();

      efficiencyChart = new Chart(ctxEff, {
        type: 'bar',
        data: {
          labels: ['Rendimiento Hidr√°ulico', 'Rendimiento Mec√°nico', 'Rendimiento Total'],
          datasets: [
            {
              label: 'Bomba Existente',
              data: [hydOld, mechOld, effOld],
              backgroundColor: onaColors.warning,
              borderColor: onaColors.warning,
              borderWidth: 2
            },
            {
              label: 'Bomba Nueva',
              data: [hydNew, mechNew, effNew],
              backgroundColor: onaColors.success,
              borderColor: onaColors.success,
              borderWidth: 2
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: true, position: 'top' }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              title: { display: true, text: 'Rendimiento (%)' }
            }
          }
        }
      });

      // Gr√°fico de distribuci√≥n de ahorros
      const ctxDist = document.getElementById('savingsDistChart').getContext('2d');
      if (savingsDistChart) savingsDistChart.destroy();

      savingsDistChart = new Chart(ctxDist, {
        type: 'doughnut',
        data: {
          labels: ['Ahorro por Bomba', 'Total ' + numPumps + ' Bomba(s)'],
          datasets: [{
            data: [savingsPerPump, savingsTotal - savingsPerPump],
            backgroundColor: [onaColors.teal, onaColors.tealLight],
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'right' },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.label + ': ' + Math.round(context.parsed).toLocaleString() + ' kWh/a√±o';
                }
              }
            }
          }
        }
      });

      // Gr√°fico de proyecci√≥n
      const years = [1, 2, 3, 5, 10, 15, 20];
      const ctxProjection = document.getElementById('projectionChart').getContext('2d');
      if (projectionChart) projectionChart.destroy();
      
      projectionChart = new Chart(ctxProjection, {
        type: 'line',
        data: {
          labels: years.map(y => `A√±o ${y}`),
          datasets: [{
            label: 'Ahorro Acumulado (‚Ç¨)',
            data: years.map(y => annualSavings * y),
            borderColor: onaColors.teal,
            backgroundColor: 'rgba(0, 139, 156, 0.1)',
            fill: true,
            tension: 0.3,
            pointRadius: 5,
            pointHoverRadius: 7
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: true }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Ahorro Acumulado (‚Ç¨)' },
              ticks: {
                callback: function(value) {
                  return value.toLocaleString() + ' ‚Ç¨';
                }
              }
            }
          }
        }
      });
    }

    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFontSize(18);
      doc.setTextColor(0, 107, 125);
      doc.text('Informe de Ahorro Energ√©tico - Bombas', 105, 20, { align: 'center' });
      
      doc.setFontSize(12);
      doc.setTextColor(108, 117, 125);
      doc.text('Ficha TER280 - Sustituci√≥n de Bomba', 105, 28, { align: 'center' });
      
      doc.setFontSize(10);
      doc.setTextColor(0, 0, 0);
      doc.text(`Fecha: ${new Date().toLocaleDateString('es-ES')}`, 20, 40);
      
      let yPos = 50;
      doc.setFontSize(14);
      doc.setTextColor(0, 107, 125);
      doc.text('Par√°metros de Entrada', 20, yPos);
      
      yPos += 8;
      doc.setFontSize(10);
      doc.setTextColor(0, 0, 0);
      
      const powerOld = document.getElementById('powerOld').value;
      const effTotalOld = document.getElementById('effTotalOld').value;
      const effTotalNew = document.getElementById('effTotalNew').value;
      const operatingHours = document.getElementById('operatingHours').value;
      const numPumps = document.getElementById('numPumps').value;
      
      doc.text(`Potencia bomba: ${powerOld} kW`, 20, yPos); yPos += 7;
      doc.text(`Rendimiento bomba existente: ${effTotalOld}%`, 20, yPos); yPos += 7;
      doc.text(`Rendimiento bomba nueva: ${effTotalNew}%`, 20, yPos); yPos += 7;
      doc.text(`Horas de funcionamiento: ${operatingHours} h/a√±o`, 20, yPos); yPos += 7;
      doc.text(`N√∫mero de bombas: ${numPumps}`, 20, yPos); yPos += 10;
      
      doc.setFontSize(14);
      doc.setTextColor(0, 107, 125);
      doc.text('Resultados', 20, yPos);
      
      yPos += 8;
      doc.setFontSize(10);
      doc.setTextColor(0, 0, 0);
      
      const savingsTotal = document.getElementById('savingsTotal').textContent;
      const costSavings = document.getElementById('costSavings').textContent;
      const co2Reduction = document.getElementById('co2Reduction').textContent;
      const efficiencyImprovement = document.getElementById('efficiencyImprovement').textContent;
      
      doc.setFont(undefined, 'bold');
      doc.text(`Ahorro Total: ${savingsTotal} kWh/a√±o`, 20, yPos); yPos += 7;
      doc.setFont(undefined, 'normal');
      doc.text(`Ahorro econ√≥mico: ${costSavings} ‚Ç¨/a√±o`, 20, yPos); yPos += 7;
      doc.text(`Reducci√≥n CO‚ÇÇ: ${co2Reduction} kg/a√±o`, 20, yPos); yPos += 7;
      doc.text(`Mejora de rendimiento: ${efficiencyImprovement}%`, 20, yPos);
      
      doc.save('Informe_Ahorro_Bombas_TER280.pdf');
    }

    function exportToCSV() {
      let csv = 'Informe de Ahorro Energ√©tico - Bombas\n';
      csv += 'Ficha TER280 - Sustituci√≥n de Bomba por otra m√°s eficiente\n\n';
      csv += `Fecha:,${new Date().toLocaleDateString('es-ES')}\n\n`;
      
      csv += 'PAR√ÅMETROS DE ENTRADA\n';
      csv += `Potencia bomba (kW):,${document.getElementById('powerOld').value}\n`;
      csv += `Rendimiento total bomba existente (%):,${document.getElementById('effTotalOld').value}\n`;
      csv += `Rendimiento total bomba nueva (%):,${document.getElementById('effTotalNew').value}\n`;
      csv += `Horas funcionamiento (h/a√±o):,${document.getElementById('operatingHours').value}\n`;
      csv += `N√∫mero de bombas:,${document.getElementById('numPumps').value}\n\n`;
      
      csv += 'RESULTADOS\n';
      csv += `Ahorro Total (kWh/a√±o):,${document.getElementById('savingsTotal').textContent}\n`;
      csv += `Ahorro Econ√≥mico (‚Ç¨/a√±o):,${document.getElementById('costSavings').textContent}\n`;
      csv += `Reducci√≥n CO‚ÇÇ (kg/a√±o):,${document.getElementById('co2Reduction').textContent}\n`;
      csv += `Mejora Rendimiento (%):,${document.getElementById('efficiencyImprovement').textContent}\n`;
      csv += `Ahorro 5 a√±os (‚Ç¨):,${document.getElementById('savings5years').textContent}\n`;
      csv += `Ahorro 10 a√±os (‚Ç¨):,${document.getElementById('savings10years').textContent}\n`;
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'Ahorro_Bombas_TER280.csv';
      link.click();
    }

    // Calcular al cargar
    calculateSavings();
  </script>
</body>
</html>
